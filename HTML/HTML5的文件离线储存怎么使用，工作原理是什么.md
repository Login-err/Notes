##### 离线存储

###### 怎么用

```html
<!DOCTYPE HTML>
<htm manifest="cache.manifest">
    
</html>
```

##### 然后cache.manifest文件的书写方式，就像下面这样

>CACHE MANIFEST
>
>#v0.11
>
>CACHE:
>
>js/app.js
>
>css/style.css
>
>
>
>NETWORK:
>
>resourse/logo.png
>
>
>
>FALLBACK:
>
>// offline.html

###### 离线存储的manifest一般由三个部分组成：

1. CACHE：表示需要离线存储的资源列表，由于包含manifest文件的页面将被自动离线存储，所以不需要把页面自身也列出来。
2. NETWORK：表示在它下面列出来的资源只有在在线的情况下才能访问，他们不会被离线存储，所以在离线情况下无法使用这些资源。不过，如果在CACHE和NETWORK中有一个相同的资源，那么这个资源还是会被离线存储，也就是是CACHE的优先级更高
3. FALLBACK：表示如果访问第一个资源失败，那么将使用第二个资源来替换它，比如上面这个文件表示的就是如果访问根目录下任意一个资源失败了，那么就去访问offline.html

##### 浏览器解析过程

浏览器如何对离线资源进行管理和加载：

* 在线的情况下，浏览器发现html头部有manifest属性，它会请求manifest文件，如果是第一个访问app，那么浏览器就会根据manifest文件的内容下载相应的资源并且进行离线存储。如果已经访问app并且资源已经离线存储了，那么浏览器就会使用离线加载页面，然后浏览器会对比新的manifest文件，如果文件没有发生改变，就不做任何操作，如果文件改变了，那么就会重新下载文件的资源并进行离线存储。
* 离线情况下，浏览器直接调用离线存储的资源。

几个注意的问题：

* 如果服务器对离线的资源进行了更新，那么必须更新manifest文件之后这些资源才能被浏览器重新下载，如果只是更新了资源没有更新manifest的话，浏览器并不会重新下载资源，也就是说还是使用原来离线存储的资源
* 对于manifest文件进行缓存的时候要十分小心，因为可能出现一种情况就是你对manifest文件进行了更新，但是http缓存告诉浏览器本地缓存的manifest文件还没有过期，这个情况下浏览器还是使用原来的manifest文件，所以对于manifest文件最好不要设置缓存
* 浏览器在下载manifest文件时，它会一次性下载所有的资源，如果下载失败的话，那么这次manifest的更新是失败的，浏览器还是会继续使用之前的资源
* 在更新资源之后，新的资源要到下次重新打开app的时候才会生效，如果想要这次就生效的话，那么使用window.applicationCache.swapCache()方法来使之生效，出现这个现象的原因是app会先使用离线资源的加载页面，然后再去检查manifest的更新。